<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Mi Cursada — {{ estudiante.apellido }}, {{ estudiante.nombre }} (DNI {{ estudiante.dni }})</title>
  <style>
    body{font-family:Arial, sans-serif; margin:20px; background:#f7f7f7}
    h1{margin:0 0 16px 0}
    .card{background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:14px; margin-bottom:18px;}
    .muted{color:#666; font-size:13px;}
    .toolbar{display:flex; gap:8px; justify-content:flex-end; margin-bottom:10px;}
    .btn{border:1px solid #999; background:#f8f8f8; padding:6px 10px; border-radius:6px; text-decoration:none; color:#111;}
    .btn:hover{background:#eee;}

    .stats{display:flex; gap:16px; margin:8px 0 12px; flex-wrap:wrap;}
    .stat{flex:1 1 260px; border:1px solid #e5e7eb; border-radius:10px; padding:10px; text-align:center; background:#fafafa}
    .stat .label{color:#666; font-size:13px; margin-bottom:6px}
    .stat .value{font-size:20px; font-weight:700}

    table{width:100%; border-collapse:collapse; font-size:14px;}
    th, td{border:1px solid #ddd; padding:6px 8px;}
    th{background:#f5f5f5; text-align:left;}
    .center{text-align:center;}

    .pill{display:inline-block; padding:2px 10px; border-radius:999px; font-size:12px; border:1px solid #ddd}
    .pill.ok{background:#dcfce7; border-color:#86efac; color:#065f46}
    .pill.bad{background:#fee2e2; border-color:#fecaca; color:#991b1b}
    .pill.neutral{background:#e5e7eb; border-color:#d1d5db; color:#111827}
  </style>
</head>
<body>

<h1>Mi Cursada — {{ estudiante.apellido }}, {{ estudiante.nombre }} (DNI {{ estudiante.dni }})</h1>

{% if items %}
  {% for it in items %}
    <div class="card">
      <div class="toolbar">
        {% if it.plan %}
          <a class="btn"
             href="{% url 'carton_generico' it.ins.profesorado.slug it.plan.resolucion_slug estudiante.dni %}">
            Ver cartón
          </a>
          <a class="btn"
             href="{% url 'carton_generico_pdf' it.ins.profesorado.slug it.plan.resolucion_slug estudiante.dni %}"
             target="_blank" rel="noopener">
            PDF
          </a>
        {% endif %}
      </div>

      <h2 style="margin:0 0 8px 0;">
        {{ it.ins.profesorado.nombre }}
        {% if it.plan %}
          <span class="muted">— Plan: Res. {{ it.plan.resolucion }}{% if it.plan.nombre %} ({{ it.plan.nombre }}){% endif %}</span>
        {% else %}
          <span class="muted">(sin plan cargado)</span>
        {% endif %}
      </h2>

      <div class="stats">
        <div class="stat">
          <div class="label">Aprobadas</div>
          <div class="value">{{ it.cuentas.aprobadas }}</div>
        </div>
        <div class="stat">
          <div class="label">Desaprobadas</div>
          <div class="value">{{ it.cuentas.desaprobadas }}</div>
        </div>
        <div class="stat">
          <div class="label">Pendientes</div>
          <div class="value">{{ it.cuentas.pendientes }}</div>
        </div>
      </div>

      {% if it.todas %}
        <table>
          <thead>
            <tr>
              <th style="width:70px;">Año</th>
              <th style="width:80px;">Cuatr.</th>
              <th>Espacio</th>
              <th style="width:130px;">Estado</th>
              <th style="width:280px;">Último movimiento</th>
            </tr>
          </thead>
          <tbody>
            {% for m in it.todas %}
              <tr>
                <td class="center">{{ m.anio }}</td>
                <td class="center">{{ m.cuatri }}</td>
                <td>{{ m.espacio }}</td>
                <td>
                  {% if m.estado == "Aprobada" %}
                    <span class="pill ok">Aprobada</span>
                  {% elif m.estado == "Desaprobada" %}
                    <span class="pill bad">Desaprobada</span>
                  {% else %}
                    <span class="pill neutral">Pendiente</span>
                  {% endif %}
                </td>
                <td>{{ m.ultimo }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="muted">No hay espacios para mostrar.</div>
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <p>No tenés inscripciones cargadas.</p>
{% endif %}

<p><a class="btn" href="{% url 'logout' %}">Cerrar sesión</a></p>

</body>
</html>
